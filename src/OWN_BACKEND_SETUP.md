# Setting Up Your Own Supabase Backend

This guide will help you create your own Supabase project so you have full ownership and control of the BrainFlip backend.

---

## Step 1: Create a Supabase Account

1. Go to **https://supabase.com**
2. Click **"Start your project"** or **"Sign Up"**
3. Sign up with GitHub, Google, or email
4. Verify your email if required

---

## Step 2: Create a New Project

1. Once logged in, click **"New Project"**
2. Fill in the project details:
   - **Name**: `BrainFlip` (or any name you prefer)
   - **Database Password**: Create a strong password (save this!)
   - **Region**: Choose the closest region to your users
   - **Pricing Plan**: Free tier is perfect for this project
3. Click **"Create new project"**
4. Wait 2-3 minutes for the project to be provisioned

---

## Step 3: Get Your Project Credentials

Once your project is ready:

1. Go to **Project Settings** (gear icon in the sidebar)
2. Click **"API"** in the settings menu
3. You'll see:
   - **Project URL**: `https://your-project-id.supabase.co`
   - **Project API keys**:
     - `anon` `public` key (safe to use in frontend)
     - `service_role` key (keep this SECRET!)

4. Copy these three values:
   - **Project Reference ID** (from the URL, e.g., `xyzabc123`)
   - **anon public key** (long JWT token starting with `eyJ...`)
   - **service_role key** (another long JWT token)

---

## Step 4: Update Frontend Credentials

After exporting your project, open it in VS Code and update the credentials:

1. Open `/utils/supabase/info.tsx`
2. Replace with your credentials:

```typescript
/* AUTOGENERATED FILE - DO NOT EDIT CONTENTS */

export const projectId = "YOUR_PROJECT_ID"  // e.g., "xyzabc123"
export const publicAnonKey = "YOUR_ANON_PUBLIC_KEY"  // The long eyJ... token
```

---

## Step 5: Set Up Backend Environment Variables

You need to add your Supabase credentials as secrets for the backend functions:

### Option A: Using Supabase CLI (Recommended)

1. Install Supabase CLI if you haven't:
   ```bash
   npm install -g supabase
   ```

2. Login to Supabase:
   ```bash
   supabase login
   ```

3. Link your project:
   ```bash
   supabase link --project-ref YOUR_PROJECT_ID
   ```

4. Set the secrets:
   ```bash
   supabase secrets set SUPABASE_URL=https://YOUR_PROJECT_ID.supabase.co
   supabase secrets set SUPABASE_ANON_KEY=YOUR_ANON_PUBLIC_KEY
   supabase secrets set SUPABASE_SERVICE_ROLE_KEY=YOUR_SERVICE_ROLE_KEY
   supabase secrets set SUPABASE_DB_URL=postgresql://postgres:YOUR_DB_PASSWORD@db.YOUR_PROJECT_ID.supabase.co:5432/postgres
   ```

### Option B: Using Supabase Dashboard

1. Go to your project dashboard
2. Navigate to **Project Settings** â†’ **Edge Functions**
3. Add these environment variables:
   - `SUPABASE_URL`: `https://YOUR_PROJECT_ID.supabase.co`
   - `SUPABASE_ANON_KEY`: Your anon public key
   - `SUPABASE_SERVICE_ROLE_KEY`: Your service role key
   - `SUPABASE_DB_URL`: `postgresql://postgres:YOUR_DB_PASSWORD@db.YOUR_PROJECT_ID.supabase.co:5432/postgres`

---

## Step 6: Deploy Backend Functions

Deploy the backend to your Supabase project:

```bash
supabase functions deploy server
```

You should see output like:
```
Deploying function server...
Function deployed successfully!
URL: https://YOUR_PROJECT_ID.supabase.co/functions/v1/server
```

---

## Step 7: Create the Database Table

The backend uses a key-value store table. Create it:

1. Go to **SQL Editor** in your Supabase dashboard
2. Click **"New Query"**
3. Paste this SQL:

```sql
-- Create the key-value store table
CREATE TABLE IF NOT EXISTS kv_store_473c2504 (
  key TEXT PRIMARY KEY,
  value JSONB NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Create index for faster queries
CREATE INDEX IF NOT EXISTS idx_kv_store_key ON kv_store_473c2504(key);

-- Enable Row Level Security (RLS)
ALTER TABLE kv_store_473c2504 ENABLE ROW LEVEL SECURITY;

-- Create policy to allow all operations (since we're using service role key on backend)
CREATE POLICY "Allow all operations" ON kv_store_473c2504
  FOR ALL
  USING (true)
  WITH CHECK (true);
```

4. Click **"Run"** to execute the query

---

## Step 8: Test Your Setup

1. Start your frontend:
   ```bash
   npm run dev
   ```

2. Open http://localhost:5173/

3. Play a game and complete it

4. Check your Supabase dashboard:
   - Go to **Table Editor**
   - Select `kv_store_473c2504` table
   - You should see data with keys like:
     - `leaderboard`
     - `user:XXXXX:progress`
     - `user:XXXXX:settings`

---

## Verification Checklist

âœ… Supabase project created  
âœ… Credentials copied from project settings  
âœ… `/utils/supabase/info.tsx` updated with new credentials  
âœ… Backend secrets configured  
âœ… Backend function deployed successfully  
âœ… Database table created  
âœ… Frontend running and connecting to backend  
âœ… Data saving to your database  

---

## Troubleshooting

### Error: "Failed to deploy function"
**Solution:** Make sure you're logged in and linked to the correct project:
```bash
supabase login
supabase link --project-ref YOUR_PROJECT_ID
```

### Error: "relation 'kv_store_473c2504' does not exist"
**Solution:** Run the SQL query in Step 7 to create the table.

### Error: 401 Unauthorized
**Solution:** 
- Verify your `publicAnonKey` is correct in `/utils/supabase/info.tsx`
- Check that backend secrets are set correctly

### Error: CORS issues
**Solution:** The backend code already handles CORS, but if issues persist:
- Verify the function deployed successfully
- Check Supabase function logs in the dashboard

---

## Benefits of Your Own Backend

âœ… **Full Control** - You own all the data  
âœ… **Privacy** - No shared database with others  
âœ… **Customization** - Modify backend logic as needed  
âœ… **Scalability** - Your own rate limits and quotas  
âœ… **Analytics** - See usage stats in your dashboard  
âœ… **Free Tier** - Supabase free tier is generous for projects like this  

---

## What You Own Now

- âœ… Your own Supabase project
- âœ… Your own database with all player data
- âœ… Your own backend API functions
- âœ… Complete control over the entire application
- âœ… Ability to modify and extend the backend

---

## Next Steps

1. **Monitor Usage**: Check your Supabase dashboard for usage stats
2. **Backup Data**: Export your database periodically from Supabase dashboard
3. **Customize**: Modify backend logic in `/supabase/functions/server/index.tsx`
4. **Deploy**: Host your frontend on Vercel, Netlify, or any platform you prefer

---

## Need Help?

- **Supabase Docs**: https://supabase.com/docs
- **Supabase Discord**: https://discord.supabase.com
- Check Supabase function logs: Dashboard â†’ Edge Functions â†’ Logs

You now have complete ownership of BrainFlip! ðŸŽ‰
